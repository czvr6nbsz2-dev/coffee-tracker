<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>Coffee Tracker</title>
  <link rel="apple-touch-icon" href="apple-touch-icon.png">
  <link rel="icon" type="image/png" href="apple-touch-icon.png">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #1b1008;
      color: #e8ddd0;
      height: 100dvh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      user-select: none;
      overflow: hidden;
      position: relative;
      transition: background 0.6s;
    }

    /* Warm radial coffee glow */
    body::before {
      content: '';
      position: fixed;
      inset: 0;
      background:
        radial-gradient(ellipse 80% 60% at 50% 40%, rgba(111, 78, 55, 0.25) 0%, transparent 70%),
        radial-gradient(ellipse 50% 50% at 30% 70%, rgba(90, 62, 40, 0.15) 0%, transparent 60%),
        radial-gradient(ellipse 40% 40% at 75% 80%, rgba(139, 90, 43, 0.12) 0%, transparent 50%);
      pointer-events: none;
      z-index: 0;
      transition: opacity 0.6s;
    }

    body.disaster::before {
      opacity: 0.3;
    }

    body.disaster {
      background: #0a0503;
    }

    /* Decorative coffee beans */
    .bean {
      position: fixed;
      width: 22px;
      height: 30px;
      opacity: 0.08;
      z-index: 0;
      pointer-events: none;
    }

    .bean svg {
      width: 100%;
      height: 100%;
    }

    .bean-1 { bottom: 3rem; left: 1.5rem; transform: rotate(-25deg); }
    .bean-2 { bottom: 5rem; left: 3.5rem; transform: rotate(15deg); width: 18px; height: 24px; opacity: 0.06; }
    .bean-3 { top: 4rem; right: 2rem; transform: rotate(40deg); width: 16px; height: 22px; opacity: 0.06; }
    .bean-4 { bottom: 2.5rem; right: 2.5rem; transform: rotate(-50deg); opacity: 0.07; }
    .bean-5 { top: 6rem; left: 2rem; transform: rotate(70deg); width: 14px; height: 19px; opacity: 0.05; }

    .content {
      position: relative;
      z-index: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .counter {
      font-size: 1.2rem;
      margin-bottom: 2rem;
      text-align: center;
      min-height: 1.8rem;
      transition: opacity 0.2s;
      color: #c4a882;
    }

    .count-number {
      font-size: 3.5rem;
      font-weight: 700;
      display: block;
      margin-bottom: 0.3rem;
      color: #f0e6d8;
      transition: color 0.4s;
    }

    body.at-limit .count-number {
      color: #d4845a;
    }

    body.over-limit .count-number {
      color: #c0392b;
    }

    body.at-limit .counter,
    body.over-limit .counter,
    body.disaster .counter {
      color: #8a6050;
    }

    .add-btn {
      width: 160px;
      height: 160px;
      border-radius: 50%;
      border: 2px solid rgba(193, 154, 107, 0.3);
      background: linear-gradient(145deg, #6f4e37, #503a28);
      color: #f0e6d8;
      font-size: 1.4rem;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 0.3rem;
      transition: transform 0.1s, box-shadow 0.2s, border-color 0.4s;
      box-shadow:
        0 4px 24px rgba(111, 78, 55, 0.5),
        0 0 60px rgba(111, 78, 55, 0.15),
        inset 0 1px 0 rgba(255, 255, 255, 0.08);
    }

    .add-btn:active {
      transform: scale(0.93);
      box-shadow:
        0 2px 12px rgba(111, 78, 55, 0.4),
        inset 0 1px 0 rgba(255, 255, 255, 0.05);
    }

    body.over-limit .add-btn,
    body.disaster .add-btn {
      border-color: rgba(192, 57, 43, 0.4);
      box-shadow:
        0 4px 24px rgba(192, 57, 43, 0.3),
        0 0 60px rgba(192, 57, 43, 0.1),
        inset 0 1px 0 rgba(255, 255, 255, 0.05);
    }

    .add-btn .icon {
      font-size: 2.5rem;
      line-height: 1;
    }

    .warning {
      margin-top: 2rem;
      padding: 0.7rem 1.2rem;
      border-radius: 8px;
      background: rgba(180, 90, 50, 0.15);
      border: 1px solid rgba(180, 90, 50, 0.35);
      color: #d4845a;
      font-size: 0.95rem;
      text-align: center;
      min-height: 3rem;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transition: opacity 0.3s;
    }

    .warning.visible {
      opacity: 1;
    }

    /* Crack overlay */
    .crack-overlay {
      position: fixed;
      inset: 0;
      z-index: 3;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.5s;
    }

    .crack-overlay.visible {
      opacity: 1;
    }

    .crack-overlay svg {
      width: 100%;
      height: 100%;
    }

    /* Disaster message */
    .disaster-msg {
      position: fixed;
      bottom: 5rem;
      left: 50%;
      transform: translateX(-50%);
      z-index: 4;
      text-align: center;
      opacity: 0;
      transition: opacity 0.6s;
      pointer-events: none;
      white-space: nowrap;
    }

    .disaster-msg.visible {
      opacity: 1;
    }

    .disaster-msg .skull {
      font-size: 1.8rem;
      display: block;
      margin-bottom: 0.4rem;
      filter: grayscale(0.5);
    }

    .disaster-msg .text {
      font-size: 0.85rem;
      color: #8a5040;
      letter-spacing: 0.03em;
      line-height: 1.5;
    }

    /* Shake animation */
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      10% { transform: translateX(-6px) rotate(-0.5deg); }
      20% { transform: translateX(5px) rotate(0.5deg); }
      30% { transform: translateX(-4px); }
      40% { transform: translateX(4px); }
      50% { transform: translateX(-2px); }
      60% { transform: translateX(2px); }
      70% { transform: translateX(-1px); }
      80% { transform: translateX(1px); }
    }

    .shake {
      animation: shake 0.6s ease-out;
    }

    /* Red vignette for disaster */
    .vignette {
      position: fixed;
      inset: 0;
      z-index: 2;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.8s;
      background: radial-gradient(ellipse at center, transparent 40%, rgba(100, 20, 10, 0.4) 100%);
    }

    .vignette.visible {
      opacity: 1;
    }

    .settings-btn {
      position: fixed;
      top: 1rem;
      right: 1rem;
      background: none;
      border: none;
      color: #6b5741;
      font-size: 1.4rem;
      cursor: pointer;
      padding: 0.5rem;
      z-index: 5;
    }

    .settings-panel {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(15, 10, 5, 0.9);
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.25s;
      z-index: 10;
    }

    .settings-panel.open {
      opacity: 1;
      pointer-events: auto;
    }

    .settings-card {
      background: #2a1f14;
      border: 1px solid rgba(193, 154, 107, 0.15);
      border-radius: 12px;
      padding: 1.5rem;
      width: 280px;
      text-align: center;
    }

    .settings-card h2 {
      font-size: 1.1rem;
      margin-bottom: 1rem;
      font-weight: 500;
      color: #c4a882;
    }

    .limit-control {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .limit-control button {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      border: 1px solid #5a4530;
      background: #3a2a1a;
      color: #c4a882;
      font-size: 1.3rem;
      cursor: pointer;
    }

    .limit-control span {
      font-size: 2rem;
      font-weight: 600;
      min-width: 2.5rem;
      color: #f0e6d8;
    }

    .close-btn {
      background: #6f4e37;
      border: none;
      color: #f0e6d8;
      padding: 0.6rem 1.5rem;
      border-radius: 8px;
      font-size: 1rem;
      cursor: pointer;
    }

    .undo-btn {
      position: fixed;
      bottom: 2rem;
      background: none;
      border: 1px solid #3a2a1a;
      color: #7a6550;
      padding: 0.5rem 1rem;
      border-radius: 6px;
      font-size: 0.85rem;
      cursor: pointer;
      opacity: 0;
      transition: opacity 0.3s;
      pointer-events: none;
      z-index: 5;
    }

    .undo-btn.visible {
      opacity: 1;
      pointer-events: auto;
    }
  </style>
</head>
<body>
  <!-- Decorative coffee beans -->
  <div class="bean bean-1"><svg viewBox="0 0 22 30"><ellipse cx="11" cy="15" rx="10" ry="14" fill="#c19a6b"/><path d="M11 3 C8 10 8 20 11 27" stroke="#1b1008" stroke-width="1.5" fill="none"/></svg></div>
  <div class="bean bean-2"><svg viewBox="0 0 22 30"><ellipse cx="11" cy="15" rx="10" ry="14" fill="#c19a6b"/><path d="M11 3 C8 10 8 20 11 27" stroke="#1b1008" stroke-width="1.5" fill="none"/></svg></div>
  <div class="bean bean-3"><svg viewBox="0 0 22 30"><ellipse cx="11" cy="15" rx="10" ry="14" fill="#c19a6b"/><path d="M11 3 C8 10 8 20 11 27" stroke="#1b1008" stroke-width="1.5" fill="none"/></svg></div>
  <div class="bean bean-4"><svg viewBox="0 0 22 30"><ellipse cx="11" cy="15" rx="10" ry="14" fill="#c19a6b"/><path d="M11 3 C8 10 8 20 11 27" stroke="#1b1008" stroke-width="1.5" fill="none"/></svg></div>
  <div class="bean bean-5"><svg viewBox="0 0 22 30"><ellipse cx="11" cy="15" rx="10" ry="14" fill="#c19a6b"/><path d="M11 3 C8 10 8 20 11 27" stroke="#1b1008" stroke-width="1.5" fill="none"/></svg></div>

  <!-- Dark red vignette for disaster mode -->
  <div class="vignette" id="vignette"></div>

  <!-- Crack overlay -->
  <div class="crack-overlay" id="crackOverlay">
    <svg viewBox="0 0 400 800" preserveAspectRatio="none" xmlns="http://www.w3.org/2000/svg">
      <!-- Main crack from top -->
      <path d="M200 0 L195 80 L210 130 L190 200 L205 260 L185 340 L200 400 L192 460 L210 520 L188 580 L200 640 L195 720 L202 800"
        stroke="rgba(160,80,50,0.25)" stroke-width="1.5" fill="none"/>
      <!-- Branch cracks -->
      <path d="M195 80 L160 120 L140 115" stroke="rgba(160,80,50,0.18)" stroke-width="1" fill="none"/>
      <path d="M210 130 L250 160 L270 155" stroke="rgba(160,80,50,0.15)" stroke-width="0.8" fill="none"/>
      <path d="M190 200 L150 230 L130 225 L110 240" stroke="rgba(160,80,50,0.18)" stroke-width="1" fill="none"/>
      <path d="M205 260 L240 290 L260 285 L280 300" stroke="rgba(160,80,50,0.15)" stroke-width="0.8" fill="none"/>
      <path d="M185 340 L145 360 L125 370" stroke="rgba(160,80,50,0.12)" stroke-width="0.8" fill="none"/>
      <path d="M200 400 L235 430 L255 425" stroke="rgba(160,80,50,0.18)" stroke-width="1" fill="none"/>
      <path d="M192 460 L155 490 L135 485" stroke="rgba(160,80,50,0.12)" stroke-width="0.8" fill="none"/>
      <path d="M210 520 L250 545 L275 540" stroke="rgba(160,80,50,0.15)" stroke-width="0.8" fill="none"/>
      <path d="M188 580 L150 610 L128 605" stroke="rgba(160,80,50,0.12)" stroke-width="0.8" fill="none"/>
      <!-- Secondary cracks -->
      <path d="M140 115 L120 150 L105 145" stroke="rgba(160,80,50,0.1)" stroke-width="0.6" fill="none"/>
      <path d="M270 155 L290 180 L305 175" stroke="rgba(160,80,50,0.08)" stroke-width="0.6" fill="none"/>
      <path d="M110 240 L90 270 L75 265" stroke="rgba(160,80,50,0.1)" stroke-width="0.6" fill="none"/>
    </svg>
  </div>

  <!-- Disaster message -->
  <div class="disaster-msg" id="disasterMsg">
    <span class="skull">&#128128;</span>
    <span class="text" id="disasterText"></span>
  </div>

  <button class="settings-btn" id="settingsBtn" aria-label="Instellingen">&#9881;</button>

  <div class="content" id="content">
    <div class="counter">
      <span class="count-number" id="countNumber">0</span>
      <span id="counterText">Vandaag: 0 koffies</span>
    </div>

    <button class="add-btn" id="addBtn">
      <span class="icon">&#9749;</span>
      <span>+1 koffie</span>
    </button>

    <div class="warning" id="warning">Dit is je max voor vandaag.</div>
  </div>

  <button class="undo-btn" id="undoBtn">Ongedaan maken</button>

  <div class="settings-panel" id="settingsPanel">
    <div class="settings-card">
      <h2>Daglimiet</h2>
      <div class="limit-control">
        <button id="limitDown">&minus;</button>
        <span id="limitValue">5</span>
        <button id="limitUp">+</button>
      </div>
      <button class="close-btn" id="closeSettings">Sluiten</button>
    </div>
  </div>

  <script>
    const STORAGE_KEY = 'coffee_tracker';

    const DISASTER_MESSAGES = [
      'Je hart klopt al in morse.',
      'De barista heeft medelijden.',
      'Dit is geen koffie meer.\nDit is een noodkreet.',
      'Ergens huilt een koffieboon.',
      'Je bloedgroep is nu espresso.',
      'Slaap is slechts een herinnering.',
      'Je tanden trillen.',
      'De koffie drinkt nu jou.',
    ];

    function loadState() {
      try {
        return JSON.parse(localStorage.getItem(STORAGE_KEY)) || {};
      } catch {
        return {};
      }
    }

    function saveState(state) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    }

    function todayStr() {
      return new Date().toISOString().slice(0, 10);
    }

    // Init
    const state = loadState();
    const today = todayStr();

    if (state.date !== today) {
      state.date = today;
      state.count = 0;
    }

    if (!state.limit) state.limit = 5;
    if (typeof state.count !== 'number') state.count = 0;

    saveState(state);

    // Elements
    const countNumber = document.getElementById('countNumber');
    const counterText = document.getElementById('counterText');
    const warning = document.getElementById('warning');
    const addBtn = document.getElementById('addBtn');
    const undoBtn = document.getElementById('undoBtn');
    const settingsBtn = document.getElementById('settingsBtn');
    const settingsPanel = document.getElementById('settingsPanel');
    const limitValue = document.getElementById('limitValue');
    const limitDown = document.getElementById('limitDown');
    const limitUp = document.getElementById('limitUp');
    const closeSettings = document.getElementById('closeSettings');
    const crackOverlay = document.getElementById('crackOverlay');
    const vignette = document.getElementById('vignette');
    const disasterMsg = document.getElementById('disasterMsg');
    const disasterText = document.getElementById('disasterText');
    const content = document.getElementById('content');

    let undoTimer = null;

    function pickDisasterMessage() {
      const over = state.count - state.limit;
      const idx = (over - 3) % DISASTER_MESSAGES.length;
      return DISASTER_MESSAGES[idx >= 0 ? idx : 0];
    }

    function render() {
      const n = state.count;
      const over = n - state.limit;
      countNumber.textContent = n;
      counterText.textContent = `Vandaag: ${n} ${n === 1 ? 'koffie' : 'koffies'}`;

      if (n >= state.limit) {
        warning.classList.add('visible');
      } else {
        warning.classList.remove('visible');
      }

      // Color escalation
      document.body.classList.remove('at-limit', 'over-limit', 'disaster');
      crackOverlay.classList.remove('visible');
      vignette.classList.remove('visible');
      disasterMsg.classList.remove('visible');

      if (over >= 3) {
        // Disaster mode: cracks, vignette, messages
        document.body.classList.add('disaster');
        crackOverlay.classList.add('visible');
        vignette.classList.add('visible');
        disasterMsg.classList.add('visible');
        disasterText.textContent = pickDisasterMessage();
      } else if (over >= 1) {
        // 1-2 over limit: red number
        document.body.classList.add('over-limit');
      } else if (over === 0) {
        // Exactly at limit: orange number
        document.body.classList.add('at-limit');
      }

      limitValue.textContent = state.limit;
    }

    function triggerShake() {
      content.classList.remove('shake');
      void content.offsetWidth; // force reflow
      content.classList.add('shake');
    }

    function showUndo() {
      clearTimeout(undoTimer);
      undoBtn.classList.add('visible');
      undoTimer = setTimeout(() => undoBtn.classList.remove('visible'), 4000);
    }

    addBtn.addEventListener('click', () => {
      // Day check on every tap
      const now = todayStr();
      if (state.date !== now) {
        state.date = now;
        state.count = 0;
      }

      state.count++;
      saveState(state);
      render();
      showUndo();

      // Shake on disaster entry
      if (state.count - state.limit >= 3) {
        triggerShake();
      }
    });

    undoBtn.addEventListener('click', () => {
      if (state.count > 0) {
        state.count--;
        saveState(state);
        render();
        undoBtn.classList.remove('visible');
        clearTimeout(undoTimer);
      }
    });

    // Settings
    settingsBtn.addEventListener('click', () => settingsPanel.classList.add('open'));
    closeSettings.addEventListener('click', () => settingsPanel.classList.remove('open'));
    settingsPanel.addEventListener('click', (e) => {
      if (e.target === settingsPanel) settingsPanel.classList.remove('open');
    });

    limitUp.addEventListener('click', () => {
      state.limit++;
      saveState(state);
      render();
    });

    limitDown.addEventListener('click', () => {
      if (state.limit > 1) {
        state.limit--;
        saveState(state);
        render();
      }
    });

    render();
  </script>
</body>
</html>
